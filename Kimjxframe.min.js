(function(){window.KJ={CONFIG:{root:"",start:"app.js",pageroot:"pages/",defaultframe:"main/main",defaultpage:"main/index",appdom:document.createElement("div"),runmode:"js",Templatemode:"default",TemplatemodeAPI:"",cachevesion:"",cachevesionkey:"kv",},EVENT:{hashchange:{},},JSCACHE:{},CSSCAHCE:{},HASH:{},LOADERCALLBACK:{},APP:{},APPLIST:[],DOMRENDER:{},init:function(a){var c=KJ;for(var b in a){c.CONFIG[b]=a[b]}Object.defineProperties(KJ,{cachevesionkey:{get:function(){return KJ.CONFIG.cachevesionkey},set:function(d){KJ.CONFIG.cachevesionkey=d}},cachevesion:{get:function(){return KJ.CONFIG.cachevesion},set:function(d){KJ.CONFIG.cachevesion=d}},});window.addEventListener("hashchange",c.Fnhashchange,false);document.body.appendChild(c.CONFIG.appdom);c.Fnloader(c.CONFIG.start)},Fneventdeal:function(a,c){var d=KJ;for(var b in d.EVENT[a]){if(c){d.EVENT[a][b](c)}else{d.EVENT[a][b]()}}},Fnregistevent:function(a,b){var d=KJ;var c=new Date().getTime()+""+parseInt(Math.random()*10000);if(!d.EVENT[a]){d.EVENT[a]={}}d.EVENT[a][c]=b;return c},Fnunregistevent:function(a,c){var b=this;delete b.EVENT[a][c];return true},Fnloader:function(b,d){var c=KJ;var a=c.CONFIG.root+b;c.Fnloadjs(a,function(){if(d){d()}})},Fnpageloader:function(a,e){var d=a.split("."),b,c=KJ;if(d.length>1){b=d[d.length-1]}else{b=c.CONFIG.runmode;a=a+"."+b}if(b=="js"){c.FngetJsTemplate(a,e)}else{c.FngetTemplate(a,e)}},FngetJsTemplate:function(b,d){var c=KJ;var a;if(c.CONFIG.Templatemode=="api"){a=c.CONFIG.root+c.CONFIG.pageroot+c.CONFIG.TemplatemodeAPI+"?page="+b+"&runmode=js"}else{a=c.CONFIG.root+c.CONFIG.pageroot+b}KJ.Fnloadjs(a,function(){if(d){d()}})},FngetTemplate:function(c,f,a){var e=KJ;if(e.APP[c]){if(f){f()}return}var b;if(e.CONFIG.Templatemode=="api"){b=e.CONFIG.root+e.CONFIG.pageroot+e.CONFIG.TemplatemodeAPI+"?page="+c+"&runmode=html"}else{if(c.split("?").length>1){b=e.CONFIG.root+e.CONFIG.pageroot+c+(KJ.CONFIG.cachevesion?"&"+KJ.CONFIG.cachevesionkey+"="+KJ.CONFIG.cachevesion:"")}else{b=e.CONFIG.root+e.CONFIG.pageroot+c+(KJ.CONFIG.cachevesion?"?"+KJ.CONFIG.cachevesionkey+"="+KJ.CONFIG.cachevesion:"")}}var d=new XMLHttpRequest();d.open("get",b,true);d.onload=function(){if((d.status>=200&&d.status<300)||d.status===0){e.Fnregistpage(d.responseText,function(){if(f){f()}},c)}else{if(a){a()}else{e.Fnregistpage("页面加载失败, errCode:"+d.status,function(){if(f){f()}},c)}}};d.send("")},getApp:function(a){var b=a.split(".");if(b.length<=1){a=a+"."+KJ.CONFIG.runmode}return KJ.APP[a]},Fnuse:function(b,e){var d=KJ;var a=0;var c=function(){if(a>=b.length){if(e){e()}}else{if(b[a][1]=="css"){d.Fnloadcss(b[a][0],function(){a++;c()})}else{if(b[a][1]=="js"){d.Fnloadjs(b[a][0],function(){a++;c()})}}}};c()},Fnloadjs:function(c,e,a){var d=KJ;if(!d.LOADERCALLBACK[c]){d.LOADERCALLBACK[c]=[]}if(d.JSCACHE[c]==2){if(e){e()}return false}if(d.JSCACHE[c]==1){d.LOADERCALLBACK[c].push(e);return false}d.LOADERCALLBACK[c].push(e);d.JSCACHE[c]=1;var b=d.Fncel("script");b.onload=function(){d.JSCACHE[c]=2;for(var f in d.LOADERCALLBACK[c]){d.LOADERCALLBACK[c][f]()}delete d.LOADERCALLBACK[c];document.body.removeChild(b)};b.onerror=function(){if(a){a()}else{console.error([c,"加载失败！"])}};if(c.split("?").length>1){b.src=c+(KJ.CONFIG.cachevesion?"&"+KJ.CONFIG.cachevesionkey+"="+KJ.CONFIG.cachevesion:"")}else{b.src=c+(KJ.CONFIG.cachevesion?"?"+KJ.CONFIG.cachevesionkey+"="+KJ.CONFIG.cachevesion:"")}document.body.appendChild(b)},Fnloadcss:function(a,d){var c=KJ;if(!c.LOADERCALLBACK[a]){c.LOADERCALLBACK[a]=[]}if(c.CSSCAHCE[a]==2){if(d){d()}return false}c.LOADERCALLBACK[a].push(d);c.CSSCAHCE[a]=1;var b=c.Fncel("link");b.rel="stylesheet";b.onload=function(){for(var e in c.LOADERCALLBACK[a]){c.LOADERCALLBACK[a][e]()}c.CSSCAHCE[a]=2;delete c.LOADERCALLBACK[a]};b.onerror=function(){console.error([a,"加载失败！"])};b.href=a+(KJ.CONFIG.cachevesion?"?"+KJ.CONFIG.cachevesionkey+"="+KJ.CONFIG.cachevesion:"");document.head.appendChild(b)},Fncel:function(a){return document.createElement(a)},Fnregistpage:function(c,f,b){var e=KJ;var a=!b?e.HASH.page:b;var d=a.split(".");if(d.length<=1){a=a+"."+KJ.CONFIG.runmode}e.APP[a]=c;if(f){f()}},FngetGet:function(e){var d={};var a=e.split("?");if(a.length>1){a=a[1].split("&")}else{a=[]}for(var b=0;b<a.length;b++){var c=a[b].split("=");if(c.length>0&&c[0]!=""&&c[1]!=""){if(c.length==1){c[1]=""}d[c[0]]=decodeURIComponent(c[1])}}return d},Fnhashchange:function(c){var d=KJ;if(c&&c.newURL){d.HASH.rawURL=c?c.newURL:location.href;d.HASH.oldURL=c?c.oldURL:location.href}else{d.HASH.oldURL=d.HASH.rawURL?d.HASH.rawURL:"";d.HASH.rawURL=location.href}var a=d.HASH.rawURL.split("#");var b=a.length>1?a[1].split("?")[0]:false;d.HASH.page=b||d.CONFIG.defaultpage;d.HASH.GET=d.FngetGet(a.length>1?a[1]:"");d.Fneventdeal("hashchange",{e:c,hash:d.HASH})},Fncleardocument:function(d,a){var c=d.querySelectorAll("*");for(var b=0;b<c.length;b++){c[b].parentNode.removeChild(c[b])}if(a){d.parentNode.removeChild(d)}}}})();